# MailDT - Mail Delivery Monitor

![MailDT Logo](static/img/logo.svg)

MailDT is a robust, self-hosted mail delivery monitoring tool designed to verify the reliability, latency, and authentication health of your email infrastructure. It performs "loopback" testing by sending unique probes via SMTP and watching for their arrival via IMAP.

## üöÄ Features

- **Round-Trip Monitoring**: Sends emails with unique GUIDs and verifies arrival.
- **Enhanced Live Monitor**: Real-time dashboard showing status, latency, and **SPF/DKIM/DMARC** results for every probe.
- **üß™ Mail Tester**: A built-in tool (similar to mail-tester.com) to manually verify your email setup. Generate a unique ID, send an email, and get instant feedback on headers and authentication.
- **Multi-Recipient Support**: Monitor multiple target mailboxes simultaneously with individual schedules.
- **Smart Alerting**: 
    - Notifications via **Discord Webhooks** and **Email**.
    - Independent toggles for alert channels per recipient.
    - Alert on **Missing** emails (threshold exceeded) and **Send Failures** (SMTP errors).
    - **Recovery** notifications when services restore.
- **Security First**:
    - **2FA (TOTP)** support for admin login.
    - Password masking in the web interface and secure session management.
- **Persistence**: Consolidated **PostgreSQL 17** storage with host-mapped volume for reliability.
- **Fast Polling**: Intelligent scheduler that speeds up IMAP checking during active manual tests.
- **Modern UI**: Clean Bootstrap 5 interface with local asset serving (no external CDNs).

## üõ†Ô∏è Setup & Installation

### 1. Prerequisites
- Docker and Docker Compose installed.
- A dedicated mail account for monitoring (SMTP and IMAP access).

### 2. Configuration
Copy the example environment file and fill in your credentials:

```bash
cp .env.example .env
```

**Key Environment Variables:**
- `SMTP_HOST` / `IMAP_HOST`: Your mail server addresses.
- `DB_USER` / `DB_PASS` / `DB_NAME`: PostgreSQL credentials.
- `ADMIN_USER` / `ADMIN_PASSWORD`: Credentials for the web UI.
- `ADMIN_TOTP_SECRET`: (Optional) Base32 secret for 2FA.
- `ENABLE_PROXY`: Set to `true` if running behind a reverse proxy.

### 3. Start the Application
```bash
docker-compose up -d --build
```

Access the dashboard at `http://localhost:5000`. Persistent data will be stored in the `./data` folder on your host.

## üñ•Ô∏è Screenshots

- **Live Monitor**: View the current health and authentication status of all recipients.
- **Mail Tester**: Manually verify SPF, DKIM, and DMARC settings with unique test IDs.
- **Recipients**: Manage target addresses with a modern modal-based workflow.

## üì¶ Tech Stack
- **Backend**: Python (Flask)
- **Database**: PostgreSQL 17 / SQLAlchemy
- **Task Runner**: APScheduler
- **Frontend**: Bootstrap (Zephyr Theme), FontAwesome 6
- **Messaging**: `smtplib`, `imaplib`

## üßπ Maintenance
The system automatically cleans up delivery history records older than 7 days every 24 hours to keep the database lightweight. Manual test results are deleted automatically after being viewed in the dashboard.

---
Generated by Gemini CLI Agent.
